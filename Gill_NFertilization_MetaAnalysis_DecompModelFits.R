#Template to fit single, double, asymptotic, and weibull litter decomposition models. Revised by ALG 2020-02-20

#read in data
setwd("~/Dropbox/UMN/MetaAnalysis/LitterDecayCurves/")
data<-read.csv("20200312_LitterDecayHarvestData.csv", header=T, sep=",")

#Here, models are fit one at a time. You could make this a loop if you 
#are convinced all your models will converge using the same starting values.
#I never have such luck.

#Load aic-liklihood library
# install.packages("bbmle")
# install.packages("stats4"
library(stats4)
library(bbmle)


#vectors for k values (col 1 or 1&2) and sse (col 2)
single.k=array(0,dim=c(max(data$DecompID, na.rm=T),1))
double.k=array(0,dim=c(max(data$DecompID, na.rm=T),3))
asymptotic.k=array(0,dim=c(max(data$DecompID, na.rm=T),3))
weibull=array(0,dim=c(max(data$DecompID, na.rm=T),7))

#Create Empty array for AIC values
a.aicc=array(0,dim=c(max(data$DecompID, na.rm=T),10)) #3aicc; 3weights; single, asym, double

half.life.calc=function(nls.mod){
  pars= coef(nls.mod)
  hl=pars[1] * (log(2))^(1/pars[2])
  names(hl)="half.life"
  return(hl)
}

mrt.calc=function(nls.mod){
  pars= coef(nls.mod)
  mrt=pars[1] * gamma(1+(1/pars[2]))
  names(mrt)="mrt"
  return(mrt)
}

LLS = function(y,k){
  Mhat=1*exp(-k*xNA$t) #creates a vector of=length to obs of preds
  ssq = sum((Mhat - xNA$Mt)^2)
  sigma = sqrt(ssq/length(xNA$Mt))
  return(-sum(dnorm(xNA$Mt,mean=Mhat,sd=sigma,log = TRUE)))
}

LLA = function(y,k,A){
  Mhat=A+(1-A)*exp(-k*xNA$t) #creates a vector of=length to obs of preds
  ssq = sum((Mhat - xNA$Mt)^2)
  sigma = sqrt(ssq/length(xNA$Mt))
  return(-sum(dnorm(xNA$Mt,mean=Mhat,sd=sigma,log = TRUE)))
}

LLD = function(y,ks,k,A){
  Mhat=A*exp(-ks*xNA$t)+(1-A)*exp(-k*xNA$t) #creates a vector of=length to obs of preds
  ssq = sum((Mhat - xNA$Mt)^2)
  #browser()
  sigma = sqrt(ssq/length(xNA$Mt))
  return(-sum(dnorm(xNA$Mt,mean=Mhat,sd=sigma,log = TRUE)))
}

quarter.life.calc=function(nls.mod){
  pars= coef(nls.mod)
  hl=pars[1] * (log(1/(3/4)))^(1/pars[2])
  names(hl)="half.life"
  return(hl)
}

tenth.life.calc=function(nls.mod){
  pars= coef(nls.mod)
  hl=pars[1] * (log(1/(9/10)))^(1/pars[2])
  names(hl)="half.life"
  return(hl)
}

data$propinit<-as.numeric(as.character(data$propinit))
######################################################################################################
i=1

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
class(t)
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
class(x$t)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)
class(xNA$Mt)


#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


 #Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0,0),upper=c(1000,1000,1000),control=list(maxit=1000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

par(mfrow=c(3,4), oma=c(0,0,0,0), mar=c(4,4,1,1), mgp=c(2.4,0.8,0), cex.lab=1.25, cex.main=1.25, cex.axis=1.15)
plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Prop. Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample1")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################################################################################################
i=2

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)




#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample2")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################################################################################################
i=3

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=as.numeric(as.character(xNA$Mt))),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .09,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample3")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################################################################################################
i=4

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .09,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=1000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample4")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################################################################################################
i=5

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample5")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################################################################################################
i=6

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample6")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################################################################################################
i=7

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample7")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################################################################################################
i=8

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample8")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################
###########################
##########################################################
i=15

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample15")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=16

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample16")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=17

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample17")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=18

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample18")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=19

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(as.numeric(as.character(Mt)) ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=as.numeric(as.character(xNA$Mt))),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample19")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=20

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample20")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=21

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample21")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=22

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample22")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=23

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample23")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=24

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample24")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=25

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample25")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


##########################################################
i=26

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample26")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=27

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample27")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=28

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample28")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=29

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample29")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=30

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample30")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


##########################################################
i=31

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample31")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

##########################################################
i=32

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample32")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# ##########################################################
# i=33
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.25), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample34")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# ##########################################################
# i=34
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample33")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# ########################################
# i=35
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,00.0001),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample35")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# ########################################
# i=36
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.000001,0.000001,0.000001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample36")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# ########################################
# i=37
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample37")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# ########################################
# i=38
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample38")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=39

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample39")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=40

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample40")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=41

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample41")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=42

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample42")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=43

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample43")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=44

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample44")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


########################################
i=45

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample45")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=46

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample46")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=47

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample47")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=48

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample48")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=49

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample49")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=51

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample51")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=52

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample52")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
########################################
i=53

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample53")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# ########################################
# i=54
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample54")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=56

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample55")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=51

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample56")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
######################
i=57

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample57")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")



########################################
i=58

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample57")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=59

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample58")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=51

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample59")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=60

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1

summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample60")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=61

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample61")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=63

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample63")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=64

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample64")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=65

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample65")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=67

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample67")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=68

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample68")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=69

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample69")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=70

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample70")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=71

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample71")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=72

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample72")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=73

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample73")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=74

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = 1,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.000001,0.0000001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample74")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")



# ########################################
# i=75
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample75")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# ########################################
# i=76
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample76")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# ########################################
# i=77
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample77")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=78

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample78")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=80

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample79")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#####################################
i=79

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample80")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


########################################
i=81

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample80")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


########################################
i=51

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample81")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=82

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample82")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=83

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=.5, alpha = .5), algorithm="port", lower=c(0.0001,0.0001), control=list(maxit=10000))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample83")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=84

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample84")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=85

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample85")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=86

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample86")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=87

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample87")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

########################################
i=88

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample88")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=89

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample89")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=90

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample90")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


######################
i=91

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample91")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=92

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample92")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=93

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample93")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=94

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample94")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=95

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample95")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=96

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample96")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=97

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample97")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=98

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample98")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


######################
i=99

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample98")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=99

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample99")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=100

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample100")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=101

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample101")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=102

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.1,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample102")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=103

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample103")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=104

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample104")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=105

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample105")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=106

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample106")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=107

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample107")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=108

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample108")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=109

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample109")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=110

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample110")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=111

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample111")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=112

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample112")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=113

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
0#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample113")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=114

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))

attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample114")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################

######################
i=115

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample115")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=116

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample116")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=117

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample117")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=118

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample118")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


######################
i=119

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample118")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=119

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample119")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=120

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample120")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=121

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample121")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=122

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample122")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=123

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample123")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


######################
i=124

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample124")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=125

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample125")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=126

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample126")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=127

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample127")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=128

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample128")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=129

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample129")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
######################
i=130

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample130")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


######################
i=131

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample131")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=132

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample132")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=133

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample133")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=134

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample134")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=135

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample135")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=136

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample136")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=137

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample137")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=138

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample138")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=139

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=1000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample139")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=140

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample140")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=141

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.15), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample141")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=142

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample142")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=143

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample143")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=144

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample144")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=145

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample145")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=146

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample146")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=147

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample147")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=148

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample148")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=149

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample149")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=150

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample150")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=151

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample151")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=152

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,00.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample152")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=153

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample153")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=154

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample154")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=155

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(00.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample155")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=156

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample156")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=157

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample157")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=158

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample158")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=159

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample159")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=160

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample160")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=161

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample161")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=162

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample162")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=163

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample163")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=164

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample164")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=165

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample165")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=166

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample166")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=167

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample167")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=168

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.2,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample168")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=169

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample169")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=170

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample170")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=171

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample171")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=171

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample171")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=172

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample172")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=173

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample173")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=174

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.25), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample174")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=175

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample175")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=176

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample176")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=177

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample177")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=178

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample178")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=179

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample179")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=180

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample180")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=181

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample181")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=182

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample182")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=183

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample183")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=184

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample184")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=185

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample185")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=186

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample186")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=187

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample187")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=188

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample188")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=189

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample189")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=190

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample190")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=191

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample191")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=192

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample192")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=193

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample193")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=194

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample194")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=195

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample195")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=196

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample196")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=197

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample197")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=198

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample198")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=199

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample199")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=200

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample200")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=201

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample201")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=202

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample202")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=203

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample203")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=204

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample204")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=205

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample205")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=206

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample206")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=207

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample207")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=208

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample208")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=209

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample209")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=210

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample210")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=211

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample211")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

######################
i=212

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample212")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=213

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample213")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=213

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample213")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=214

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample214")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=215

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample215")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=216

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample216")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=217

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample217")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=218

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample218")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=219

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample219")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=220

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample220")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=221

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample221")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=222

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample222")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=223
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample223")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=224

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample224")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=225

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample225")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=226
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample226")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=227
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample227")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 

#######################################################################################################
i=228

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample228")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=229

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample229")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=230
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample230")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
i=231

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample231")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=232

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample232")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=233
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample233")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=234
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample234")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=235

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample235")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=236

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample236")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=237
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample237")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=238

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample238")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=239

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample239")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=240
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample240")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=241
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample241")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 

#######################################################################################################
i=242

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample242")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=243

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample243")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=244
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample244")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
i=245

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample245")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=246

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample246")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=247
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample247")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=248
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample248")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=249

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample249")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=250

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample250")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=251
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample251")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
i=252

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample252")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=253

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample253")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=254
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample254")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=255
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample255")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=256

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample256")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=257

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample257")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=258
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample258")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=259

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample259")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=260

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.1,A =.1)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample260")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=261
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample261")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=262
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample262")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=263

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample263")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=264

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample264")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=265
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample265")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
i=266

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample266")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=267

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample267")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=268
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample268")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=269
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample269")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 

#######################################################################################################
i=270

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample270")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=271

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample271")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# 
# #######################################################################################################
# i=272
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample272")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
i=273

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample273")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=274

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample274")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=275
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample275")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=276
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample276")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=277

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample277")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=278

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample278")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=279
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample279")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 

#######################################################################################################
i=280

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample280")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=281

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample281")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=282
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample282")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=283
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample283")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=284

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample284")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=285

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample285")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=286
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample286")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=287

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample287")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=288

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample288")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=289

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample289")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=290
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample290")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=291

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample291")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=292

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample292")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=293
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample293")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=294

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample294")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=295

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample295")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=296
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
#  #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample296")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=297
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample297")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=298

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample298")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=299

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample299")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# 
# #######################################################################################################
# i=300
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample300")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=301

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.151,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample301")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=302

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample302")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# 
# #######################################################################################################
# i=303
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample303")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=304
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample304")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 

#######################################################################################################
i=305

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample305")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")



#######################################################################################################
i=306

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample306")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=307

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample307")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=308

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample308")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=309

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample309")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=310

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample310")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=311

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample311")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=312

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample312")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")



#######################################################################################################
i=313

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample313")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=314

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample314")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=315

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample315")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=316

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample316")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=317

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample317")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=318

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample318")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=319

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample319")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=320

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample320")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=321

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=1000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample321")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=322

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample322")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=323

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample323")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=324

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample324")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=325

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample325")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=326

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample326")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=327

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample327")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=328

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample328")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=329

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample329")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=330

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample330")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=331

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample331")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=332

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample332")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=333

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample333")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=334

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample334")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=335

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .79,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.21,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample335")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=336

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample336")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=337

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample337")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=338

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample338")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=339

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample339")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=340

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample340")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=341

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample341")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=342

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample342")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=343

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample343")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=344

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)


weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample344")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=345

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample345")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=346

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample346")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=347

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample347")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=348

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample348")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=349

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample349")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=350

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample350")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=351

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample351")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# 
# #######################################################################################################
# i=352
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample352")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=353
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001,0.0001),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample353")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=354
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# asymptotic.k[i,]
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=.51,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample354")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=355

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample355")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=356

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample356")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=357

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample357")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=358

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample358")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=359

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample359")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=360

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample360")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=361

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample361")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=362

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample362")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=363

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample363")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=364

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample364")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=365

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample365")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=366

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample366")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=367

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample367")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=368

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.051,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample368")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=369

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample369")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=370

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample370")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=371

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample371")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=372

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample372")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=373

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample373")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=374

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample374")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=375

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]

a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample375")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=376

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample376")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=377

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample377")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=378

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample378")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=379

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample379")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=380

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample380")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=381

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample381")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=382

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample382")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=383

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample383")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=384

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample384")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=385

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample385")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=386

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample386")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=387

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample387")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=388

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.25), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample388")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=389

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample389")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=390

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.25), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample390")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=391

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample391")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=392

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample392")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


# #######################################################################################################
# i=393
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample393")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=394
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample394")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=395
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample395")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# 
# #######################################################################################################
# i=396
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample396")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 

#######################################################################################################
i=397

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)]
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample397")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=398

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample398")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=399

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample399")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


#######################################################################################################
i=400

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample400")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=401

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample401")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=402

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample402")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=403

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample403")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=404

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample404")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=405

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .59,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample405")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=406

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample406")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=407

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample407")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=408

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample408")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=409

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample409")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=410

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample410")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=411

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample411")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=412

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample412")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=413

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample413")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=414

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample414")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=415

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample415")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=416

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample416")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=417

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample417")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=418

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample418")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=419

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample419")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=420

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample420")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=421

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample421")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=422

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample422")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=423

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample423")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=424

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample424")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=425

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)


#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample425")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=426

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample426")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=427

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample427")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=428

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample428")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=429

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample429")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=430

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample430")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=431
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample431")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=432
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample432")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=433

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample433")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=434
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample434")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=435
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample435")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=436

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample436")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=437

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample437")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=438

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample438")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=439

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample439")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=440

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample440")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=441

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample441")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=442

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample442")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=443

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample443")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=444
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=.051, alpha = .051), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample444")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=445
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample445")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=446
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample446")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=447

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=.1, alpha = .1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample447")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=448

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample448")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=449

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample449")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=450

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample450")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=451

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample451")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=452

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample452")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=453

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample453")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=454

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.41,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)


#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample454")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=455

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .019,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample455")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=456

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample456")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=457

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample457")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=458

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample458")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=459

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.1,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample459")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=460

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample460")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=461

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample461")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=462

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample462")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=463

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample463")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=464

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample464")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)

lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=465

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample465")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=466

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample466")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=467

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample467")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=468

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample468")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=469

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample469")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=470

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample470")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=471

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample471")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=472

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample472")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=473

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample473")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=474

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample474")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=475

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample475")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=476

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample476")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=477

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample477")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=478

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample478")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=479

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample479")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=480

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample480")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=481

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample481")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=482

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample482")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=483

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample483")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=484

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample484")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=485

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample485")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=486

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample486")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=487

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample487")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=488

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample488")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=489

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample489")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=490

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample490")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=491

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample491")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=492

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample492")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=493

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample493")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=494

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.1,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample494")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=495

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample495")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=496

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample496")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=497

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample497")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=498

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample498")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=499

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample499")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=500

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample500")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=501

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample501")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=502

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample502")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=503

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample503")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=504

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample504")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=505

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample505")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=506

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample506")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=507

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample507")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=508

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample508")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=509

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample509")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=510

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample510")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=511

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample511")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=512

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.8,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample512")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=513

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample513")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=514

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample514")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=515

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.51,ks=.93,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample515")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=516

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample516")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=517

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample517")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=518

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample518")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=519

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample519")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=520

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample520")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=521

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample521")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=522

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample522")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=523

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample523")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=524

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample524")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=525

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample525")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=526

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample526")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=527

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample527")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=528

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample528")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=529

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample529")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=530

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample530")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=531

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample531")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=532

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample532")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=533

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample533")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=534

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample534")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=535

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample535")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=536

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample536")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=537

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample537")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=538

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample538")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=539

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample539")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=540

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample540")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=541

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample541")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=542

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample542")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=543

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample543")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=544

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample544")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=545

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample545")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=546

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample546")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=547

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample547")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=548

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample548")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=549

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample549")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=550

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample550")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=551

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample551")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=552

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample552")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=553

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample553")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=554

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample554")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=555

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample555")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=556

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.25), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample556")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=557

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample557")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=558

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample558")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=559

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample559")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=560

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample560")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=561

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample561")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=562

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample562")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=563

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample563")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=564

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample564")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=565

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample565")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=566

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample566")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=567

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample567")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=568

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample568")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=569

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=.1, alpha = .1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 1), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0001),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample569")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=570

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample570")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=571

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample571")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=572

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]
asymptotic.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample572")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=573

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample573")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=574

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample574")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=575

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample575")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=576

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample576")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=577

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample577")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=578

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.81,ks=.3,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=1000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A
double.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample578")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=579

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample579")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=580

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample580")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=581

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k =.1,A=0), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample581")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=582

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = 1,A=0), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.0000001,0.00000001),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample582")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=583

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample583")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=584

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample584")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=585

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample585")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=586

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample586")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=587

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample587")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=588

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 1), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample588")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=589

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample589")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=590

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample590")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=591
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.3,A =.4)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample591")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=592
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample592")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=593

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample593")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=594

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample594")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=595

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample595")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=596

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample596")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

# #######################################################################################################
# i=597
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.95), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample597")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")
# 
# #######################################################################################################
# i=598
# 
# s1=subset(data,data$DecompID==i)
# #browser()
# #create new data frame (with appropriate column names) to put in 
# # only necessary columns, so you don't get messed up
# # by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# # delete the entire row whether you need Final_N for your analysis or not
# t=s1$Years
# t1<-seq(0,5,length.out=10000)
# Mt=s1$propinit
# x <- data.frame(t, Mt)
# #omit lines with missing data (NAs)
# xNA <-na.exclude(x)
# 
# 
# 
# #Weibull function
# fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
# weibull[i,1]=coef(fit)[2]
# weibull[i,2]=coef(fit)[1]
# weibull[i,3]<-mrt.calc(fit)
# weibull[i,4]<-half.life.calc(fit)
# weibull[i,5]<-sum(resid(fit)^2)
# weibull[i,6]<-quarter.life.calc(fit)
# weibull[i,7]<-tenth.life.calc(fit)
# summary(fit)
# 
# weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
# weibull.AIC<-AIC(fit)
# 
# 
# #Single pool 
# #Method 1: Liklihood function	
# 
# singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
# #add 1 to K (in AIC caculation) for estimating sigma
# attr(singleLL ,"df") = attr(singleLL,"df")+1
# summary(singleLL)
# 
# #Extract k value
# single.k[i,1]=coef(singleLL)[1]
# 
# single.exp.fit<-exp(-single.k[i,1]*t1)
# 
# 
# 
# #Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
# #Liklihood function	
# asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
# attr(asymLL ,"df") = attr(asymLL,"df")+1
# summary(asymLL)
# 
# #Extract k & A value
# asymptotic.k[i,1]=coef(asymLL)[1]
# asymptotic.k[i,2]=coef(asymLL)[2]
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# 
# #Asymptotic preds
# if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
# if(i>1){
#   predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
#   predmle2.a=append(predmle2.a,predmle2temp)
# }
# 
# 
# #Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
# #Liklihood function	
# start=list(k=1,ks=.03,A =.04)
# doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
# attr(doubleLL ,"df") = attr(singleLL,"df")+1
# summary(doubleLL)
# 
# #Extract k value; ks&A, k&(1-A)
# double.k[i,1]=coef(doubleLL)[1]#ks
# double.k[i,2]=coef(doubleLL)[2]#k
# double.k[i,3]=coef(doubleLL)[3]#A
# 
# asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
# double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))
# 
# #Double preds
# if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
# if(i>1){
#   predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
#   predmle2.d=append(predmle2.d,predmle2temp)
# }
# 
# #SummaryData
# Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
# Sample1xx
# a.aicc[i,1]=Sample1xx$dAICc[1]
# a.aicc[i,2]=Sample1xx$dAICc[2]
# a.aicc[i,3]=Sample1xx$dAICc[3]
# a.aicc[i,4]=Sample1xx$weight[1]
# a.aicc[i,5]=Sample1xx$weight[2]
# a.aicc[i,6]=Sample1xx$weight[3]
# a.aicc[i,7]=Sample1xx$AICc[1]
# a.aicc[i,8]=Sample1xx$AICc[2]
# a.aicc[i,9]=Sample1xx$AICc[3]
# a.aicc[i,10]=weibull.AIC
# a.aicc[i,c(7:10)]
# 
# plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample598")
# lines(t1,exp(-single.k[i,1]*t1), col="grey")
# lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
# lines(t1, double.exp.fit, col="orange", lty=3)
# lines(t1, weibull.fit, col="dodgerblue1", lty=1)
# #legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=599

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample599")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=600

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample600")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=601

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample601")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=602

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample602")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=603

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample603")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=604

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample604")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=605

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample605")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=606

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample606")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=607

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample607")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=608

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]
asymptotic.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(1000,1000,1000),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample608")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=609

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]
asymptotic.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample609")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=610

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]
asymptotic.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample610")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=611

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]
asymptotic.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample611")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=612

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .1,A=0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]
asymptotic.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample612")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=613

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(1000))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(1000,1000))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]
asymptotic.k[i,]
asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample613")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=614

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.9,ks=.1,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample614")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=615

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .19,A=0.02), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=.1,ks=.03,A =.04)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=10000, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample615")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=616

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample616")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=617

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample617")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=618

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample618")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=619

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample619")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=620

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample620")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=621

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample621")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=622

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]

plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample622")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")

#######################################################################################################
i=623

s1=subset(data,data$DecompID==i)
#browser()
#create new data frame (with appropriate column names) to put in 
# only necessary columns, so you don't get messed up
# by excluding NA's from unneeded columns (e.g., if Final_N data is missing R will 
# delete the entire row whether you need Final_N for your analysis or not
t=s1$Years
t1<-seq(0,5,length.out=10000)
Mt=s1$propinit
x <- data.frame(t, Mt)
#omit lines with missing data (NAs)
xNA <-na.exclude(x)



#Weibull function
fit<- nls(Mt ~ exp(-(t/beta)^alpha), start =list(beta=1, alpha = 1), algorithm="port", lower=c(0.0001,0.0001))
weibull[i,1]=coef(fit)[2]
weibull[i,2]=coef(fit)[1]
weibull[i,3]<-mrt.calc(fit)
weibull[i,4]<-half.life.calc(fit)
weibull[i,5]<-sum(resid(fit)^2)
weibull[i,6]<-quarter.life.calc(fit)
weibull[i,7]<-tenth.life.calc(fit)
summary(fit)

weibull.fit<-exp(-(t1/weibull[i,2])^weibull[i,1])
weibull.AIC<-AIC(fit)


#Single pool 
#Method 1: Liklihood function	

singleLL = mle2(minuslogl = LLS, start = list(k = 0.5), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0),upper=c(100))
#add 1 to K (in AIC caculation) for estimating sigma
attr(singleLL ,"df") = attr(singleLL,"df")+1
summary(singleLL)

#Extract k value
single.k[i,1]=coef(singleLL)[1]

single.exp.fit<-exp(-single.k[i,1]*t1)



#Asymptotic (method 1 only): M(t)=A+(1-A)*exp(-k*t)
#Liklihood function	
asymLL = mle2(minuslogl = LLA, start = list(k = .9,A=0.2), data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0,0),upper=c(100,100))#,control=list(maxint=10e6))
attr(asymLL ,"df") = attr(asymLL,"df")+1
summary(asymLL)

#Extract k & A value
asymptotic.k[i,1]=coef(asymLL)[1]
asymptotic.k[i,2]=coef(asymLL)[2]

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))

#Asymptotic preds
if(i==1){predmle2.a=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])}
if(i>1){
  predmle2temp=asymptotic.k[i,2]+(1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*x[,1])
  predmle2.a=append(predmle2.a,predmle2temp)
}


#Double pool (method 1 only): propinitmass = A*exp(-ks*t)+(1-A)*exp(-k*t);
#Liklihood function	
start=list(k=1,ks=.3,A =.4)
doubleLL = mle2(minuslogl = LLD, start = start, data = list(y=xNA$Mt),method="L-BFGS-B", lower=c(0.00001,0.00001,0.00001),upper=c(100,100,100),control=list(maxit=100, trace=TRUE, parscale=abs(unlist(start))))
attr(doubleLL ,"df") = attr(singleLL,"df")+1
summary(doubleLL)

#Extract k value; ks&A, k&(1-A)
double.k[i,1]=coef(doubleLL)[1]#ks
double.k[i,2]=coef(doubleLL)[2]#k
double.k[i,3]=coef(doubleLL)[3]#A

asymptotic.k.fit<-asymptotic.k[i,2]+((1-asymptotic.k[i,2])*exp(-asymptotic.k[i,1]*t1))
double.exp.fit<-(double.k[i,3]*exp(-double.k[i,1]*t1))+((1-double.k[i,3])*exp(-double.k[i,2]*t1))

#Double preds
if(i==1){predmle2.d=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])}
if(i>1){
  predmle2temp=double.k[i,3]*exp(-double.k[i,1]*x[,1])+(1-double.k[i,3])*exp(-double.k[i,2]*x[,1])
  predmle2.d=append(predmle2.d,predmle2temp)
}

#SummaryData
Sample1xx<-AICctab(singleLL,asymLL,doubleLL, nobs=nrow(x), sort=FALSE,base=TRUE, weights=TRUE)
Sample1xx
a.aicc[i,1]=Sample1xx$dAICc[1]
a.aicc[i,2]=Sample1xx$dAICc[2]
a.aicc[i,3]=Sample1xx$dAICc[3]
a.aicc[i,4]=Sample1xx$weight[1]
a.aicc[i,5]=Sample1xx$weight[2]
a.aicc[i,6]=Sample1xx$weight[3]
a.aicc[i,7]=Sample1xx$AICc[1]
a.aicc[i,8]=Sample1xx$AICc[2]
a.aicc[i,9]=Sample1xx$AICc[3]
a.aicc[i,10]=weibull.AIC
a.aicc[i,c(7:10)]



plot(t,Mt, pch=16, col="dark grey", xlab="Years",ylab="Proportion Remaining", xlim=c(0,5), ylim=c(0,1), main="Sample623")
lines(t1,exp(-single.k[i,1]*t1), col="grey")
lines(t1, asymptotic.k.fit, col="mediumpurple", lty=2)
lines(t1, double.exp.fit, col="orange", lty=3)
lines(t1, weibull.fit, col="dodgerblue1", lty=1)
#legend("topright", c("single", "asymp.", "double", "weibull"), col=c("grey","mediumpurple","orange","dodgerblue1"), lty=c(1,2,3,1), bty="n")


colnames(a.aicc)<-c("Single_dAICc", "Asym_dAICc", "Double_dAICc", "Single_weight", "Asym_weight", "Double_Weight", "Single_AICc", 
                    "Asym_AICc", "Double_AICc", "weibull.AIC")
head(a.aicc)
a.aicc[,3]

k_vals<-cbind(
single.k,
double.k,
asymptotic.k,
weibull)
head(k_vals)

colnames(k_vals)<-c("single.k", "double.ks", "double.k","double.A", "asymp.k", "asymp.A", "double.empty", "weibull.beta", "weibull.alpha", "weibull.mrt", 
              "weibull.half.life", "weibull.RSS", "weibull.quarter", "weibull.tenth")
head(double.k)
head(k_vals)

write.csv(a.aicc, "20190801_a.aicc_table.csv")
write.csv(k_vals, "20190801_k_vals_table.csv")

